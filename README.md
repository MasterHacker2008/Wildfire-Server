# Wildfire Risk Server

**Small FastAPI app that collects sensor data and predicts wildfire risk.** ðŸ”§

---

## Overview

This project is a lightweight server that accepts temperature and humidity sensor data, stores it in `data.csv`, and returns a predicted risk probability (0â€“100%) using a pre-trained model (`model.pkl`). It also exposes historical data and a WebSocket to notify clients of new sensor readings.

## Files

- `main.py` â€” FastAPI application. Provides endpoints:
  - `GET /data` â€” returns the contents of `data.csv` as JSON (list of records).
  - `POST /data` â€” accepts JSON with `temperature` and `humidity`, appends a timestamped row to `data.csv`, runs the prediction, and returns `{ "probability": <int> }`.
  - `WebSocket /ws` â€” pushes new readings to connected clients when new data is posted.

- `test.py` â€” small script to load `model.pkl` and make a single example prediction.
- `data.csv` â€” CSV storing timestamped sensor readings (columns: `datetime,temperature,humidity`).
- `model.pkl` â€” pre-trained scikit-learn model (required to make predictions). Not checked in here â€” place it in the project root.



## How the prediction is computed

- The server passes `[temperature, humidity]` to the model.
- The returned value is computed from `model.predict_proba(...)` and rounded: this is returned as `probability` in the response.

## Installation

Recommended: use a virtual environment and install from `requirements.txt`.

```bash
python -m venv .venv
.\.venv\Scripts\activate    # Windows PowerShell
pip install --upgrade pip
pip install -r requirements.txt
```

If you prefer not to use `requirements.txt`, install the main packages directly:

```bash
pip install fastapi uvicorn[standard] pandas numpy joblib scikit-learn pydantic
```

## Run the server

Start the app with uvicorn from the project directory:

```bash
uvicorn main:app --reload --host 0.0.0.0 --port 8000
```

Then open `http://127.0.0.1:8000/docs` to view the interactive OpenAPI docs (auto-generated by FastAPI).

## Example usage

- POST a new reading (curl):

```bash
curl -X POST "http://127.0.0.1:8000/data" -H "Content-Type: application/json" -d "{ \"temperature\": 21.0, \"humidity\": 65.0 }"
```

- GET historical data:

```bash
curl http://127.0.0.1:8000/data
```

- Simple Python example to POST:

```python
import requests
r = requests.post('http://127.0.0.1:8000/data', json={'temperature': 21.0, 'humidity': 65.0})
print(r.json())
```

- Connect to the WebSocket (JavaScript example):

```js
const ws = new WebSocket('ws://127.0.0.1:8000/ws');
ws.onmessage = e => console.log('new data:', e.data);
```

## Testing

Run `python test.py` to load `model.pkl` and make a sample prediction. This helps verify that `model.pkl` is compatible.

## Data format

- `data.csv` columns: `datetime` (ISO timestamp), `temperature` (float), `humidity` (float).

## Notes & Tips ðŸ’¡

- Ensure `model.pkl` is present in the project root before starting the server.
- The server allows CORS from anywhere (configured with `allow_origins=['*']`) â€” this is convenient for development but consider restricting it for production.
- `update_event` is used internally to notify websocket clients when new data arrives.

---


